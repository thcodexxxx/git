# 株式管理ダッシュボード

日本株、米国株、投資信託を一元管理できるStreamlitアプリケーションです。資産の評価額、損益状況、ポートフォリオの構成比（ヒートマップ）などを直感的に把握できます。

## 特徴
*   **マルチポートフォリオ**: 「保有株式」と「仮想保有株式」の2つを管理可能。
*   **自動データ取得**: 株価は `yfinance`、投資信託はYahoo!ファイナンスから自動取得。
*   **可視化**: Plotlyによる資産ヒートマップ、Matplotlibによる個別銘柄のチャート表示。
*   **キャッシュ機能**: 投資信託データのキャッシュにより、読み込み速度を最適化。
*   **一括取込**: 手動リストからの株価自動取得・取込ツールを追加。

## セットアップ

### 1. 前提条件
*   Python 3.8以上
*   インターネット接続 (株価データの取得に必要)

### 2. インストール
リポジトリをクローンまたはダウンロードし、必要なライブラリをインストールします。

```bash
cd kabu
pip install -r requirements.txt
```

## 使い方

### アプリケーションの起動
以下のコマンドでStreamlitアプリを起動します。

```bash
streamlit run stock_app.py
```

ブラウザが立ち上がり、ダッシュボードが表示されます (通常は `http://localhost:8501`)。

### ポートフォリオの登録
1.  **ポートフォリオ選択**: サイドバー上部のラジオボタンで「保有株式」または「仮想保有株式」を選択します。
2.  **データの入力**: メイン画面のテーブルにお持ちの銘柄情報を入力します。
    *   **コード**:
        *   日本株: `7203.T` (トヨタ自動車) のように `.T` を付けます。
        *   米国株: `AAPL` (Apple), `MSFT` (Microsoft) などのティッカーシンボル。
        *   投資信託: Yahoo!ファイナンスのファンドコード (例: `01314184` ... ｅＭＡＸＩＳ Ｓｌｉｍ 米国株式（Ｓ＆Ｐ５００）)。
    *   **購入単価**: 平均取得単価 (円またはドル)。投資信託は1万口あたりの単価。
    *   **購入日**: `YYYY-MM-DD` 形式。
    *   **保有株数**: 株数 (投資信託の場合は口数)。

データは自動的に `portfolio_main.csv` または `portfolio_sub.csv` に保存されます。

### 手動リストからの取り込み（仮想ポートフォリオ）
手動で作成したリストを読み込み、指定日の株価を自動取得して `portfolio_sub.csv` に追記できます。

1.  `import_data.txt` に以下の形式（タブ区切り推奨）でデータを貼り付けます。
    ```text
    No.	分析日	銘柄コード	銘柄名	...
    1	2026/01/01	9216	ビーウィズ	...
    ```
    ※分析日が休場日の場合、自動的に直近の営業日の終値を取得します。

2.  以下のコマンドを実行します。
    ```bash
    python import_stock_data.py
    ```

## ファイル構成
*   `stock_app.py`: アプリケーション本体
*   `import_stock_data.py`: 手動リスト取り込みツール
*   `import_data.txt`: 取り込み用データファイル
*   `stock_research_agent.py`: (Experimental) AIによる銘柄リサーチツール
*   `specification.md`: 詳細仕様書
*   `stock_data_cache/`: 取得した投資信託データのキャッシュ

## 注意事項
*   投資信託のデータはスクレイピングで取得しているため、対象サイトの仕様変更により取得できなくなる場合があります。
*   サイドバーの「キャッシュを削除して再取得」ボタンで、キャッシュをクリアして最新データを強制取得できます。
